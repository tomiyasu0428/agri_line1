StraightBar Lite – Visual v0.2.3-robust

概要
- 屋外作業で「まっすぐ」を維持するため、左右の横ズレを大きく見せる軽量Webアプリ（PWA対応）。
- スマホ内蔵GPSを利用して、A点→B点で基準となる直線（ABライン）を作り、現在位置の横ズレ（m）を表示。
- iOS Safariで位置更新が止まるケースに備え、watchPosition停止時は自動でポーリングへフォールバック。

主な機能
- ヘッダー表示: GPS状態、精度(m)、速度(km/h)、進行方位(°)、更新Hz、モード（watch/polling）
- 中央表示: 横ズレ量（小数2桁, m）と方向（左/右）
- サブ情報: A→現在距離、AB距離（5m未満時は横ズレ計算を停止）
- 可視化: キャンバス上に基準線と作業幅グリッド、現在のズレを矩形で表示
- 警告: 3秒以上位置更新がない場合に注意表示
- 操作: 計測開始/停止、A/B設定、作業幅、前/次ライン、最寄ライン（ボタンのみ。ロジックは今後実装）

想定ユースケース
- 軽トラ・トラクタの手動直進補助
- 散布の重複/漏れ低減

使い方（現場）
1. ページを開く（デプロイ直後は `?v=timestamp` を付けてキャッシュ回避推奨）
2. 「計測開始」を押す（停止ボタンが有効になればOK）
3. A点を設定 → 10〜30m直進 → B点を設定（ヘッダーやログでAB距離≥5mを確認）
4. 必要に応じて「最寄ライン」でターゲット合わせ、「←/→」で前後ライン切替
5. ヘッダーで精度（≤15m）/更新Hz（≈1–2Hz）/速度の変化を確認

注意事項
- スマホGPSは実用上 ±数m〜十数m 程度の誤差。狭い作業幅では“目安用途”に留まる
- iOS Safariで継続更新しない事象があるため、フォールバック（polling）を実装
- HTTPSもしくはlocalhostでのGeolocation利用を推奨

既知の課題と対策（抜粋）
- 旧版が表示される: Service Worker/HTTPキャッシュが原因になり得るため、別ディレクトリに配置、`?v=`付与、PWA再追加など
- 最初の1回だけ位置が来て止まる: 低電力/権限/屋内環境の影響。v0.2.3-robustで自動フォールバック、iOSの位置設定見直し
- 横ズレが常に0.00: AB距離<5m時は向きが決まらないため横ズレ計算を停止。A/Bを10〜30m離して再設定
- 精度が高まらない: 屋外で数十秒待つ、遮蔽物を避ける、ダッシュボード上での設置、移動しながら再取得

将来対応（TODO）
- 外部GNSS（Bluetooth/NMEA）入力
- 描画レンジの自動スケール、ズレ履歴表示
- 音声ガイダンス強化、夜間モード、画面常時ON、フィルタリセット、状態保存
- 作業記録（距離・面積）の自動集計

開発者向け
- 構成: `index.html`（UI）, `app.js`（ロジック/描画）, `style.css`（スタイル）, `manifest.json`（PWA）, `icons/`（アイコン）
- 地図投影: A点を原点とした平面近似（WGS84, R=6,378,137m）。緯度経度差をメートル座標へ変換
- 横ズレ計算: ABベクトルに対するクロストラック距離。`offset = currentLineIndex * swathWidth - perp`
- 位置取得: watchPosition（高精度/timeout設定）→ 3–5秒更新停止で `getCurrentPosition` への毎秒ポーリングへ切替

ローカル実行
1. 任意の静的サーバで配信（例: `python -m http.server` など）
2. スマホでアクセスし、位置情報権限を「使用中のみ許可」＋「正確な位置情報 ON」に設定（iOS）

デプロイ運用（例: GitHub Pages）
- ディレクトリ単位で配置し、SWの影響を切り分けやすくする
- 更新後は `?v=timestamp` を付与してキャッシュ回避
- PWAは更新のたびにいったん削除→再追加が確実

バージョン
- v0.2.3-robust（Service Workerなし検証版）

ライセンス
-（未指定。必要に応じて追記）


