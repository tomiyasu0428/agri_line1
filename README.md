StraightBar Lite – Visual v0.2.6-robust

概要
- 屋外作業で「まっすぐ」を維持するため、左右の横ズレだけを大きく見せる軽量Webアプリ（PWA対応）。
- スマホ内蔵GPSで A→B の基準直線（ABライン）を作り、現在位置の横ズレ（m）を表示。
- iOS Safariで位置更新が止まる場合に自動でポーリングへフォールバックし、安定後は自動復帰。

主な機能（v0.2.6）
- ヘッダー表示: GPS状態、精度(m)、速度(km/h)、更新Hz、モード（watch/polling）
- 中央表示: 横ズレ量（0.0 m）と方向（左/右）
- サブ情報: A→現在距離、AB距離（5m未満時は横ズレ計算を停止）
- 可視化: VISUALレンジ=「±作業幅」、作業幅ごとの交互ストライプ、ライン境界を跨ぐとバーが一時点滅
- 操作: 計測開始/停止、A/B設定、作業幅、前/次ライン、最寄ライン、ここをゼロ（現在位置でラインをゼロ合わせ）
- 画面常時ON: Wake Lock対応（対応端末）

使い方（現場）
1. ページを開く（更新直後は `?v=timestamp` を付けてキャッシュ回避推奨）
2. 「計測開始」を押す（停止ボタンが有効ならOK）
3. A点を設定 → 10〜30m直進 → B点を設定（AB距離≥5m）
4. 「最寄ライン」で合わせ、「ここをゼロ」で現在位置をゼロ合わせ
5. ヘッダーの精度（≤15m）/更新Hz（≈1–2Hz）/速度を確認

注意事項
- スマホGPSは実用上 ±数m〜十数m 程度。狭い作業幅では“目安”用途に留まる
- iOS Safariの継続更新不具合に備えてフォールバック（polling）を実装
- HTTPSもしくはlocalhostでのGeolocation利用を推奨

ドキュメント（docs）
- [8月20日修正メモ](docs/8月20日修正.md)
- [初期バージョン課題](docs/初期バージョン課題.md)
- [USAGE](docs/USAGE.md)
- [次期修正案](docs/次期修正案.md)
- [外部GPS拡張](docs/外部GPS拡張.md)
- [改善提案](docs/改善提案.md)

開発者向け
- 構成: `index.html`（UI）, `app.js`（ロジック/描画）, `style.css`（スタイル）, `manifest.json`（PWA）, `icons/`（アイコン）
- 投影: A点を原点とした平面近似（WGS84, R=6,378,137m）。緯度経度差をメートル座標へ変換
- 横ズレ計算: `offset = currentLineIndex * swathWidth - perp`（右が正、左が負）
- 位置取得: watchPosition → 3–5秒更新停止で `getCurrentPosition` 毎秒ポーリングへ切替（安定後は自動でwatchへ復帰）

ローカル実行
1. 任意の静的サーバで配信（例: `python -m http.server`）
2. 端末の位置情報権限を「使用中のみ許可」＋「正確な位置情報 ON」に設定（iOS）

デプロイ運用（GitHub Pages想定）
- ディレクトリ単位で配置するとSWの影響を切り分けやすい
- 更新後は `?v=timestamp` を付与してキャッシュ回避
- PWAは更新のたびにいったん削除→再追加が確実

変更履歴
- v0.2.6: VISUALレンジ=±作業幅、ストライプ表示、境界跨ぎ時のバー点滅、「ここをゼロ」再計算ロジック修正、左右符号修正
- v0.2.3-robust: watch停止時の自動フォールバックと自動復帰、ヘッダーにモード表示

ライセンス
- 未設定（必要に応じて追記）

