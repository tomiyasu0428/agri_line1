StraightBar Lite – Visual 使い方（v0.2.3-robust）

対応環境
- iOS: Safari（PWA/ホーム画面追加を含む）。HTTPSまたはlocalhostが必須。設定 → プライバシーとセキュリティ → 位置情報サービス → Safari（またはPWA名）を「使用中のみ許可」かつ「正確な位置情報」をONにする。
- Android: Chrome 推奨（その他のモダンブラウザでも可）。初回アクセス時に位置情報の許可を与える。
- 端末共通: 屋外の開けた場所で使用。低電力モードはOFF推奨。画面の自動ロックは可能なら延長/無効化。

初回準備
1. アプリのURLを開く（更新直後は `?v=timestamp` を付与してキャッシュ回避を推奨）
2. PWAとして使う場合は「ホーム画面に追加」して起動
3. 位置情報の許可ダイアログが出たら許可

基本操作
1. 「計測開始」
2. その場で「A点 設定」
3. 10〜30mほどまっすぐ進む
4. 進んだ地点で「B点 設定」（AB距離が5m未満だと横ズレ計算は停止）
5. 必要に応じて「作業幅（m）」を設定
6. 「最寄ライン」で近い基準ラインへターゲット合わせ（将来的にロジック拡張予定）
7. 「← 1本前へ」「1本次へ →」で並行ラインを切替
8. 終了するときは「停止」

画面の見方
- ヘッダー: GPS状態 / 精度(m) / 速度(km/h) / 進行方位(°) / 更新: Hz / モード（watch or polling）
- 中央: 横ズレ量（m, 小数2桁）と方向（左/右）
- 補助: A→現在距離、AB距離（5m以上が目安）
- 可視化: キャンバスに基準線と作業幅グリッド、現在のズレを矩形で強調
- 警告: 3秒以上位置更新がないと注意文表示

モードの意味
- watch: ブラウザの watchPosition により、位置が届くたび自動で更新
- polling: 5秒以上更新が止まった際の自動フォールバック。毎秒 getCurrentPosition を呼んで位置を取りに行く（およそ1Hz）。
  - watch に戻すには「停止→計測開始」や再読み込みで再試行

推奨設定・運用
- 端末の低電力モードをOFF。屋外でGPS信号が良好な場所で使用
- iOSは「正確な位置情報」をON
- PWAを更新した場合は、一度削除→Safariで最新を確認→再追加
- GitHub Pages等で更新後は `?v=timestamp` を付けてキャッシュを確実に避ける

トラブルシュート
- 旧版が表示される（UIが古い／更新: Hzが出ない）
  - `?v=timestamp` を付ける、PWAを削除して再追加、別フォルダで再デプロイ
- 位置が最初の1回だけで止まる／更新: -Hz のまま
  - polling へ自動移行。止まる場合は「停止→計測開始」や再読み込み、屋外で再試行、iOSの位置設定見直し
- 横ズレが常に0.00／中央ラインが消える
  - AB距離が5m未満のため。A/Bを10〜30m離して取り直す
- 精度が悪い（>20〜30mが続く）
  - 屋外でしばらく待つ／移動して再取得／遮蔽物を避ける

制約・注意
- スマホ内蔵GPSの実用精度は ±数m〜十数m 程度。狭い作業幅では“目安用途”に留まる
- 本アプリは端末内で完結するクライアントサイドアプリ。位置データはサーバに送信しない設計

既知の未実装項目
- 最寄ラインのスナップロジックの詳細化
- 画面常時ON、音声ガイダンス、夜間モード、フィルタリセット、状態保存
- 描画レンジ自動スケール、ズレ履歴表示、作業記録（距離・面積）集計

バージョン
- v0.2.3-robust（Service Workerなし検証版）


